function searchmetadata(e,t,n,r,i){var s=e;termstoremove=["HD","official","video","-","audio","lyrics","feat","ft."];$.each(termstoremove,function(e,t){var n=new RegExp(t,"gi");s=s.replace(n,"")});s=cropuntil(cropuntil(s,"("),"/");s=cropuntil(cropuntil(s,"["),"/");$.ajax({url:"http://ws.audioscrobbler.com/2.0/",data:{method:"track.search",track:s,api_key:"29c1ce9127061d03c0770b857b3cb741",format:"json"},async:!1,success:function(e){if(e.results["opensearch:totalResults"]!="0"){var t=e.results["opensearch:totalResults"]!=1?e.results.trackmatches.track[0]:e.results.trackmatches.track,s=t.name,o=t.artist;$("<img>").addClass("fadeandslide rec-thumb").attr("src",thumb).appendTo(randomdiv);$.ajax({url:"http://ws.audioscrobbler.com/2.0/",data:{method:"track.getInfo",track:s,artist:o,format:"json",api_key:"29c1ce9127061d03c0770b857b3cb741"},asnyc:!1,success:function(e){var t=e.track;t.album==undefined?t.album={title:"Unknown",image:"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="}:t.album.image=t.album.image[t.album.image.length-1]["#text"];$("<img>").addClass("fadeandslide rec-album").attr("src",t.album.image).appendTo(randomdiv);var s={hoster:"youtube",hosterid:n,title:t.name,artists:t.artist.name,album:t.album.title,cover:t.album.image,id:t.id,countries:i,length:r,artistsid:t.artist.mbid,albumid:t.album.mbid};console.log(s);$.ajax({url:"http://buzztube.site11.com/backend/songs/add.php",data:s,dataType:"json",success:function(e){if(e.success=="true"){$("<div>").text(formatDuration(r)).addClass("fadeandslide rec-check").appendTo(randomdiv);var t=$("<div>").addClass("finishedrecognized");$("<img>").addClass("recognized-cover").attr("src",s.cover).appendTo(t);$("<div>").addClass("recognized-title").text(s.title).appendTo(t);$("<div>").addClass("recognized-artist").text(s.artists).appendTo(t);$("<div>").addClass("recognized-album").text(s.album).appendTo(t);$("<div>").addClass("recognized-length").text(formatDuration(s.length)).appendTo(t);setTimeout(function(){randomdiv.animate({opacity:0},2e3);t.insertAfter(randomdiv).fadeIn();setTimeout(function(){$("<div>").addClass("spark").insertAfter(randomdiv)},1e3)},1e3)}}})}})}}})}function contains(e,t){return e.indexOf(t)!=-1}function cropat(e,t){return contains(e,t)?e.substr(e.indexOf(t)+t.length):e}function cropuntil(e,t){return contains(e,t)?e.substr(0,e.indexOf(t)):e}function formatDuration(e){var t,n;if(e>60){t=Math.floor(e/60);n=Math.floor(e-t*60)}else{t=0;n=Math.floor(e)}n<10&&(n="0"+n);return""+t+":"+n}function parseId(e){if(contains(e,"youtube.com")&&contains(e,"watch?"))return cropuntil(cropat(e,"watch?v="),"&")}$(document).ready(function(){$("body").removeClass("preload");$("textarea").live("dragover dragenter",function(e){$("#drag-area").addClass("fileover");$("#drop-music").addClass("fileover-text")});$("textarea").live("dragleave",function(){$("#drag-area").removeClass("fileover");$("#drop-music").removeClass("fileover-text")});$("textarea").live("drop",function(e){$("#drag-area").removeClass("fileover");$("#drop-music").removeClass("fileover-text");setTimeout(function(){url=$("textarea").val();$("textarea").val("");if(contains(url,"youtube.com")){var e=parseId(url);$.ajax({url:"http://gdata.youtube.com/feeds/api/videos/"+e,data:{alt:"json"},success:function(t){var n=t.entry.title.$t;randonnumber=Math.floor(Math.random()*1e5);randomid=$("<div>").attr("id",randonnumber).appendTo("#recognitionlist");randomdiv=$("#"+randonnumber);$("<img>").addClass("fadeandslide").attr("src","images/youtube-metro.png").appendTo(randomdiv);thumb=t.entry.media$group.media$thumbnail[t.entry.media$group.media$thumbnail.length-2].url;countries=t.entry.media$group.media$restriction!=undefined?t.entry.media$group.media$restriction.$t:"all";searchmetadata(n,"youtube",e,t.entry.media$group.yt$duration.seconds,countries)},asnyc:!1})}else $("<p>").addClass("fadeandslide").text("Link can not be recognized. Try a YouTube link!").appendTo("#recognitionlist")})})});